version: '1'
package:
  id: cn.linyaps.tauri.demo
  name: tauri-app
  version: 0.0.0.1
  kind: app
  description: |
    a tauri demo.

command: [start-tauri-app]

base: org.deepin.base/25.2.0

build: |
  # 安装依赖
  bash ./install_dep linglong/sources $PREFIX
  # 复制可执行文件，需要先执行yarn tauri build
  cp src-tauri/target/release/bundle/deb/tauri-app_0.1.0_amd64/data/usr/bin/tauri-app $PREFIX/bin
  # 替换so中的硬编码路径，将 /x86_64-linux-gnu/ 替换成 _XXXXXXXXXXXXXXXX_ 可以保持路径字符串的长度不变并且不会在多个应用之间冲突
  # mktemp 会将X替换成随机字符
  tmpdir=`mktemp -d /tmp/lib_XXXXXXXXXXXXXXXX_webkit2gtk-4.1`
  sed -i -b "s|/usr/lib/x86_64-linux-gnu/webkit2gtk-4.1|$tmpdir|g" $PREFIX/lib/x86_64-linux-gnu/libwebkit2gtk-4.1.so.0

  # 启动脚本将 /opt 下面的 webkit2gtk-4.1 复制到 /tmp 目录，并启动应用
  startScript="$PREFIX/bin/start-tauri-app"
  echo "#!/bin/sh" > $startScript
  echo "rm -r $tmpdir" >> $startScript
  echo "ln -s $PREFIX/lib/x86_64-linux-gnu/webkit2gtk-4.1 $tmpdir" >> $startScript
  echo "tauri-app" >> $startScript
  chmod +x $startScript

sources:
  # linglong:gen_deb_source sources amd64 https://ci.deepin.com/repo/deepin/deepin-community/stable crimson/release main community
  # linglong:gen_deb_source install libwebkit2gtk-4.1-0
  # linglong:gen_deb_source install libsoup-3.0-0
  # linglong:gen_deb_source install libjavascriptcoregtk-4.1-0
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/i/igerman98/aspell-de_20161207-9_all.deb
    digest: 124abf699c146ad654c5f52f08a20f37936aa56f6b020c4a31e8ed2bcd697136
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/a/aspell/aspell_0.60.8-6_amd64.deb
    digest: d0a1cf2583ca5ed794671c4156ff6d03c7ceb7166c8d752f828f17ebdde4c7b6
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/b/bubblewrap/bubblewrap_0.10.0-1_amd64.deb
    digest: e82acc13972c1d2f717ce85ca7a48b6368acad650cb9be60f97ba32bc62ee3b0
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/d/dbus-broker/dbus-broker_29-3_amd64.deb
    digest: 68ff1baedb2f4ced1ff5d2f9c3e59bd21e741b7710931e0539c89ef5951df8ba
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/f/fonts-noto/fonts-croscore_20201225-deepin_all.deb
    digest: afbaf120869a08aa7dd14da9ad014de48a751aa4330534b531410bb86c411b55
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/f/fonts-freefont/fonts-freefont-otf_20120503-10_all.deb
    digest: c66666da94b9a0477351ee9d6d7a247a0a3c842e428da770991b45f03be2ee72
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/f/fonts-freefont/fonts-freefont-ttf_20120503-10_all.deb
    digest: 79b23c3945d4628463672a804a0e81bc4c262ef87cb6316afb40167a50bc3145
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/f/fonts-liberation/fonts-liberation_2.1.5-3_all.deb
    digest: 9285213fd8d6515bc6c1be5b810bf39918a668a17024a9fd3541879ce7fb5344
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/t/tex-gyre/fonts-texgyre_20180621-3.1_all.deb
    digest: f66d6f798c4b99d8490558cc8209c069b0fe5577c11378c0e01f9e87ddf10824
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gst-plugins-base1.0/gstreamer1.0-plugins-base_1.24.6-1_amd64.deb
    digest: 3a15070887e53d04d0866eded24713e905f78309ead3da0bf4710654406a082f
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gst-plugins-good1.0/gstreamer1.0-plugins-good_1.24.6-1deepin1+rb1_amd64.deb
    digest: 7cf975e4a6a3408354939c982a922698d22c9c59f9e9cb6a044b7e2257f121e8
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/s/scowl/hunspell-en-us_2020.12.07-1_all.deb
    digest: 6a8253970b5399571a39d53de050d169ed3eae866aa656b0dea37531a68549de
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/b/br.ispell/ibrazilian_3.0~beta4-23_all.deb
    digest: 271a5d6c7cb4af761d0f8453843eeed532c5669f8cd699bff8ccf3c4ae74e4fa
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/i/ispell/ispell_3.4.02-2_amd64.deb
    digest: 2db3cd70af980d785fe5701f824cbbbdc8bc8a1d0258494e95fb74a2a6aec158
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/a/aalib/libaa1_1.4p5-50_amd64.deb
    digest: 7a3de1da3ffd08698978bfab35bb32d959fa479ccf8b30d35fc9f0723fd7e973
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/a/aspell/libaspell15_0.60.8-6_amd64.deb
    digest: 48f3715adf9e0fb486f9f89778d357d2c8c81a4246fdfc0057bdbf0c405c190b
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gcc-13/libatomic1_13.2.0-3deepin4_amd64.deb
    digest: 7cbfd9612f03e31bb16d7226c083d23c8fa1f073fcbac2d09af4df96302b7f21
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/liba/libavc1394/libavc1394-0_0.5.4-5_amd64.deb
    digest: 27a869ad9b0f6673fe4c6e6dc6aae04f58b550fa9f2de4c9c9ba64cda6e9937a
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/liba/libavif/libavif15_0.11.1-3_amd64.deb
    digest: 572845eabad9ceadcfd1923b940e4c56d4b9cc0636134774cd3a2dd9a1c35701
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libc/libcaca/libcaca0_0.99.beta20-4deepin0_amd64.deb
    digest: eef9bf124cff1a9617eb134d328b3862d6e1396783fbfe922b9cead4637fb9d5
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/c/cdparanoia/libcdparanoia0_3.10.2+debian-14_amd64.deb
    digest: bf47490b840a1f50b2a98f453dc3ec61c3f52913e8ca6f74533100c8bd48ac2b
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libd/libdv/libdv4_1.0.0-14_amd64.deb
    digest: 4bc16faa05512b3a581c8364f8469be8532c8cb561b76dfb9712b3f68e23f1fe
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/e/enchant-2/libenchant-2-2_2.3.3-2_amd64.deb
    digest: 6bf41db97a6589eee69a6598ce2bc2943e39dd5a1b679f00185bb40bbc487896
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libe/libevdev/libevdev2_1.12.0+dfsg-1_amd64.deb
    digest: 48c0a7c73d835054b291645fa21fd597271e28a6eb98d8b22f2283e364e83893
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libf/libfile-find-rule-perl/libfile-find-rule-perl_0.34-1_all.deb
    digest: 8ebc94473bf3381e34408415da523e390c2fb3be418f3c298deb6bc82373ded5
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/f/flite/libflite1_2.2-6_amd64.deb
    digest: b051da086707e0aa6576b97646a5f4ab6a4d0ef16e1657d06bee41d50d2be9af
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libg/libgav1/libgav1-0_0.17.0-1_amd64.deb
    digest: a4589dc11a92741054acd8ea7e7c53557cc38a7a0ae44e0c164219e8da298110
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gpm/libgpm2_1.20.7-9_amd64.deb
    digest: c00c715e31122bef570e1ffc5fbb122e4f0fc54f717b40dd1866aa577ca69339
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gssdp/libgssdp-1.6-0_1.6.2-2_amd64.deb
    digest: be889b9f488dfb7caa598230fbc39e65d91e552cb6082c4d4757de66d61ae02b
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gst-plugins-base1.0/libgstreamer-gl1.0-0_1.24.6-1_amd64.deb
    digest: 5e0621339870e5af412c689c0fc54313fa60f09c94262689c3b0b8fd6dead35d
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gst-plugins-bad1.0/libgstreamer-plugins-bad1.0-0_1.24.6-1deepin1_amd64.deb
    digest: a6b820cc9fbc7b9a022657405031c73f81b54615d328c26c5a3066360b9d033c
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libg/libgudev/libgudev-1.0-0_238-2deepin1_amd64.deb
    digest: fb9f1c72e40fd7fece5eab37c9eb473bf3d19c84fb808512d60af3bc909a8c5f
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gupnp/libgupnp-1.6-0_1.6.3-1_amd64.deb
    digest: b99969e9abb77fc8840f1f4b2ab33fac849c3313e09ec95cc71772ce9902bc0a
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/g/gupnp-igd/libgupnp-igd-1.6-0_1.6.0-3_amd64.deb
    digest: 0288bcf567dbfc64b440d737e76a771073c20c3444a6821739084afcb62f27f1
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/h/hunspell/libhunspell-1.7-0_1.7.0-4_amd64.deb
    digest: 79fd52b00d64290c91bc3331a52203a9972967711d3587f8abd6326ae61f4d47
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/h/hyphen/libhyphen0_2.8.8-7_amd64.deb
    digest: d4d72b7419db3fb7bb9663d30c2336eee0244bee22fc8b7bdec37e266bb17ace
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/w/webkit2gtk/libjavascriptcoregtk-4.1-0_2.48.0-1_amd64.deb
    digest: 6addc315fbef11d7dbffec75be9b928ceca5975c2a2142df68f596bc297e95aa
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libm/libmanette/libmanette-0.2-0_0.2.6-3_amd64.deb
    digest: b5506c6c22c38db3ec4ade518c0603e76bcce5d8eb9ce62fdfb5805d3a88a31e
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/m/mpg123/libmpg123-0_1.32.8-1deepin1_amd64.deb
    digest: 8da2a921507884c5bb32854be4feaa1fcf5cd51d5d41b413e0f75982ad578a9f
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libn/libnice/libnice10_0.1.21-2_amd64.deb
    digest: 2f015d4f7d3c7484b736bd960f8ff4729333867065b081cc36445f419bb50075
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libn/libnumber-compare-perl/libnumber-compare-perl_0.03-2_all.deb
    digest: c37a63d53d982b9596a8e498e9ef95cf07cc245eaa2a8df8fc8546e82511fa7c
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/o/opencore-amr/libopencore-amrnb0_0.1.5-1_amd64.deb
    digest: ed16bb492bba32dfcc90bbc65c77903c27354c907fcdbe96d86b35e3b3e836a2
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/o/opencore-amr/libopencore-amrwb0_0.1.5-1_amd64.deb
    digest: 0edde1c02bf7dc2c1f7cc4c44996e7e7ac73bd89e457ccec2d0a29d66ab0dbf1
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libs/libsecret/libsecret-1-0_0.21.4-1_amd64.deb
    digest: 3f0d57a746a87803d4ac369c23f451cfd3dea8fb2d90890486d7bbb33d8e747e
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libs/libsecret/libsecret-common_0.21.4-1_all.deb
    digest: 2c12c067604e4872a281ddd17347c2a8bfa35ec65c086d46aed37414786205ab
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libs/libshout/libshout3_2.4.5-1_amd64.deb
    digest: b7d0c8f00e6353ddecc9429a2687cf123f251b5a0500336a328b65a4ce5d4042
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/s/slang2/libslang2_2.3.2-5_amd64.deb
    digest: d0d482e555d5fb78b0606cb2a54a24f071a5389f216f348f4d210e2b57ecf4ed
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libs/libsoup3/libsoup-3.0-0_3.4.3-1_amd64.deb
    digest: 9888c53cf0e3cedfe9c8f06e3e08d225b063843874a74f9d74518cb25fc182e6
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/community/libs/libsoup3/libsoup-3.0-0_3.6.5-1_amd64.deb
    digest: a4b1d5eeb4a98bf8a3d33974b46da58776a9ba8cccbf35b297c43c460e578683
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/community/libs/libsoup3/libsoup-3.0-common_3.6.5-1_all.deb
    digest: 1ea79c817fec9cdbea2a333656efe9898ed4a7492018321c6b8a1a12a013ae35
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/t/taglib/libtag1v5-vanilla_1.12-1deepin0_amd64.deb
    digest: 4fdd6319d141f7950b7a0581b38a34f9a2e63f35a8ff38b2ed13a7a77e80e90e
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/t/taglib/libtag1v5_1.12-1deepin0_amd64.deb
    digest: 6981b6a6a11c8e04e81c0e149166261c159f4860055f0dd25e3ed3cdffd14fa7
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libt/libtext-glob-perl/libtext-glob-perl_0.11-2_all.deb
    digest: 2e8cf563b486b56b4c875db16a37e5e24168085510b8bfd167efc8367cdcad1f
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libv/libvisual/libvisual-0.4-0_0.4.0-17_amd64.deb
    digest: d8d2635755c1d7f682572b1e440495f0234dbaa87c003431e3e5177d7679e7af
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/w/wavpack/libwavpack1_5.4.0-1_amd64.deb
    digest: 4ac1acbfdd1a76a3e42bc193729cb09e7daab9e076223aed2400817b652877f4
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/w/webkit2gtk/libwebkit2gtk-4.1-0_2.48.0-1_amd64.deb
    digest: 9c13c47584ab12c63559364f94c2579237e94d974093e32ad53884e436d7828a
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/w/woff2/libwoff1_1.0.2-1-deepin1_amd64.deb
    digest: 92a25161de8298a529c3e8158ae21b4343c513e16cac6946a0ffa1166dba72db
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/libx/libxslt/libxslt1.1_1.1.34-4_amd64.deb
    digest: 57b60e3910615c73c78c090eb6f5a3d69c13638e2f212fe651a610e6b6d72ced
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/liby/libyuv/libyuv0_0.0.1888.20240710-3_amd64.deb
    digest: ee79d2e37a74fff74155751702fc35a4623f23093950fecb5cadb80dc23b9f6c
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/m/myspell-fa/myspell-fa_0.20070816-3.2_all.deb
    digest: fcd6b94d6e806790ee905d61deae2b08a01bd5523ca90dfcbfef24e5f39f0245
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/u/usrmerge/usrmerge_39+nmu2deepin1_all.deb
    digest: 544feca0992471720cd5648cf88b0241df5d32cf72c2037ab5d19fd617a15a29
  - kind: file
    url: https://ci.deepin.com/repo/deepin/deepin-community/stable/pool/main/x/xdg-dbus-proxy/xdg-dbus-proxy_0.1.2-2_amd64.deb
    digest: c3b1d158ff9817f081886255c70743563df35a871731f5a0f2b2b8ff35405a7d